{"ast":null,"code":"import _regeneratorRuntime from\"E:/FRONTEND/webphim/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"E:/FRONTEND/webphim/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"E:/FRONTEND/webphim/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{datVeApiAction,layThongTinPhongVeApiAction}from'../../redux/actions/QuanLyPhimActions';import{datGheAction}from'../../redux/actions/QuanLyPhimActions';import screen from'../../assets/screen.png';import{Fragment}from'react';import{USER_LOGIN}from'../../Util/Config';import swal from'sweetalert';import Swal from'sweetalert2';export default function ChiTietPhongVe(props){var _thongTinPhongVe$thon,_thongTinPhongVe$thon2,_thongTinPhongVe$thon3,_thongTinPhongVe$danh,_thongTinPhongVe$thon4,_thongTinPhongVe$thon5,_thongTinPhongVe$thon6,_thongTinPhongVe$thon7,_thongTinPhongVe$thon8,_thongTinPhongVe$thon9;var thongTinPhongVe=useSelector(function(state){return state.QuanLyPhimReducer.thongTinPhongVe;});var danhSachGheDangDat=useSelector(function(state){return state.QuanLyPhimReducer.danhSachGheDangDat;});var _useState=useState({minutes:0,seconds:0}),_useState2=_slicedToArray(_useState,2),time=_useState2[0],setTime=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),over=_useState4[0],setOver=_useState4[1];var dispatch=useDispatch();// useEffect(async () => {\n//     let maLichChieu = props.match.params.maLichChieu;\n//     dispatch(await layThongTinPhongVeApiAction(maLichChieu));\n// }, []);\nuseEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var maLichChieu;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:maLichChieu=props.match.params.maLichChieu;_context.t0=dispatch;_context.next=4;return layThongTinPhongVeApiAction(maLichChieu);case 4:_context.t1=_context.sent;(0,_context.t0)(_context.t1);case 6:case\"end\":return _context.stop();}}},_callee);}));return _fetchData.apply(this,arguments);}fetchData();},[props.match.params.maLichChieu,dispatch]);var _useState5=useState(window.innerHeight),_useState6=_slicedToArray(_useState5,2),height=_useState6[0],setHeight=_useState6[1];useEffect(function(){window.onresize=function(){setHeight(window.innerHeight);};},[height]);var start=function start(){if(over)return;if(time.minutes===0&&time.seconds===0){setOver(true);swal(\"Hết thời gian giữ ghế vui lòng đặt lại!\",{buttons:{cancel:\"Thoát!\",ok:\"Đặt lại vé\"}}).then(function(value){switch(value){case\"ok\":reset();break;default:props.history.push('/home');}});}else if(time.seconds===0)setTime({minutes:time.minutes-1,seconds:59});else setTime({minutes:time.minutes,seconds:time.seconds-1});};var reset=function reset(){setTime({minutes:3,seconds:0});setOver(false);};useEffect(function(){if(thongTinPhongVe.danhSachGhe!=null){var timerID=setInterval(function(){return start();},1000);return function(){return clearInterval(timerID);};}},[start]);useEffect(function(){setTime({minutes:3,seconds:0});},[]);var renderCountDown=function renderCountDown(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text\",children:\"Th\\u1EDDi gian gi\\u1EEF gh\\u1EBF\"}),/*#__PURE__*/_jsx(\"p\",{className:\"time\",children:\"\".concat(time.minutes.toString().padStart(2,'0'),\":\\n             \").concat(time.seconds.toString().padStart(2,'0'))})]});};var tongTien=danhSachGheDangDat.reduce(function(tongTien,gheDangDat,index){return tongTien+=gheDangDat.giaVe;},0);var disable=tongTien===0?'disable':'';var cursor=tongTien===0?'no-drop':'';var backgroundColor=tongTien===0?'#cfcfcf':'#fb4226';var opacity=tongTien===0?'0.7':'';var mangSapXepGheDangDat=danhSachGheDangDat.sort(function(ghe,gheTT){return ghe.stt-gheTT.stt;});return/*#__PURE__*/_jsx(\"section\",{className:\"container-fluid chiTietPhongVe\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chiTietPhongVe__content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chiTietPhongVe__manHinh\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"thongTin__Rap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"thongTin__Rap-content\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\" \",/*#__PURE__*/_jsx(\"img\",{src:(_thongTinPhongVe$thon=thongTinPhongVe.thongTinPhim)===null||_thongTinPhongVe$thon===void 0?void 0:_thongTinPhongVe$thon.hinhAnh,alt:\"filmImage\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"thongTin__Rap-diaChi\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"ten__Rap\",children:(_thongTinPhongVe$thon2=thongTinPhongVe.thongTinPhim)===null||_thongTinPhongVe$thon2===void 0?void 0:_thongTinPhongVe$thon2.tenCumRap}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"dia__Chi\",children:(_thongTinPhongVe$thon3=thongTinPhongVe.thongTinPhim)===null||_thongTinPhongVe$thon3===void 0?void 0:_thongTinPhongVe$thon3.diaChi})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"thongTin__Rap-timeOut\",children:renderCountDown()})]}),/*#__PURE__*/_jsx(\"div\",{className:\"manHinh\",children:/*#__PURE__*/_jsx(\"img\",{src:screen,alt:\"screen\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"danhSachGhe\",children:(_thongTinPhongVe$danh=thongTinPhongVe.danhSachGhe)===null||_thongTinPhongVe$danh===void 0?void 0:_thongTinPhongVe$danh.map(function(ghe,index){var classGheVip=ghe.loaiGhe==='Thuong'?'':'gheVip';var classGheDaDat=ghe.daDat?'gheDaDat':'';var disable=ghe.daDat?'disable':'';var noiDungBtn=ghe.daDat?'X':ghe.stt;var indexGheDangDat=danhSachGheDangDat.findIndex(function(gheDangDat){return ghe.maGhe===gheDangDat.maGhe;});var classGheDangDat=indexGheDangDat!==-1?'gheDangDat':'';return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){if(danhSachGheDangDat.length<=5){dispatch(datGheAction(ghe.maGhe,ghe.stt,ghe.giaVe));}else{if(indexGheDangDat!==-1){dispatch(datGheAction(ghe.maGhe,ghe.stt,ghe.giaVe));}else{swal({text:\"Mỗi booking chỉ tối đa 6 ghế!\"});}}},disabled:\"\".concat(disable),className:\"ghe \".concat(classGheVip,\" \").concat(classGheDaDat,\" \").concat(classGheDangDat),children:noiDungBtn}),(index+1)%16===0?/*#__PURE__*/_jsx(\"br\",{}):'']},index);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"loaiGhe\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"loaiGhe__item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"ghe\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Gh\\u1EBF th\\u01B0\\u1EDDng\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"loaiGhe__item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"ghe gheVip\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Gh\\u1EBF VIP\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"loaiGhe__item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"ghe gheDaDat\",children:\"X\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Gh\\u1EBF \\u0111\\xE3 \\u0111\\u01B0\\u1EE3c \\u0111\\u1EB7t\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"loaiGhe__item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"ghe gheDangDat\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Gh\\u1EBF \\u0111ang ch\\u1ECDn\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chiTietPhongVe__thongTin\",style:{height:height},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"thongTin__tongTien\",children:[danhSachGheDangDat.reduce(function(tongTien,gheDangDat,index){return tongTien+=gheDangDat.giaVe;},0).toLocaleString(),\" VND\"]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"m-0 d-flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"thongTin_hinhAnh\",children:/*#__PURE__*/_jsx(\"img\",{src:(_thongTinPhongVe$thon4=thongTinPhongVe.thongTinPhim)===null||_thongTinPhongVe$thon4===void 0?void 0:_thongTinPhongVe$thon4.hinhAnh,alt:\"phimImage\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"thongTin__phim\",children:[/*#__PURE__*/_jsx(\"h4\",{children:(_thongTinPhongVe$thon5=thongTinPhongVe.thongTinPhim)===null||_thongTinPhongVe$thon5===void 0?void 0:_thongTinPhongVe$thon5.tenPhim}),/*#__PURE__*/_jsxs(\"h6\",{children:[(_thongTinPhongVe$thon6=thongTinPhongVe.thongTinPhim)===null||_thongTinPhongVe$thon6===void 0?void 0:_thongTinPhongVe$thon6.tenCumRap,\" - \",(_thongTinPhongVe$thon7=thongTinPhongVe.thongTinPhim)===null||_thongTinPhongVe$thon7===void 0?void 0:_thongTinPhongVe$thon7.tenRap]}),/*#__PURE__*/_jsxs(\"p\",{children:[(_thongTinPhongVe$thon8=thongTinPhongVe.thongTinPhim)===null||_thongTinPhongVe$thon8===void 0?void 0:_thongTinPhongVe$thon8.ngayChieu,\" - \",(_thongTinPhongVe$thon9=thongTinPhongVe.thongTinPhim)===null||_thongTinPhongVe$thon9===void 0?void 0:_thongTinPhongVe$thon9.gioChieu]})]})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"thongTin_ghe\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"Gh\\u1EBF: \"}),\" \",mangSapXepGheDangDat===null||mangSapXepGheDangDat===void 0?void 0:mangSapXepGheDangDat.map(function(gheDangDat,index){return/*#__PURE__*/_jsxs(\"span\",{className:\"viTriGhe\",children:[gheDangDat.stt,\" \\xA0 \"]},index);})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"tienGhe\",children:[danhSachGheDangDat.reduce(function(tongTien,gheDangDat,index){return tongTien+=gheDangDat.giaVe;},0).toLocaleString(),\" \\u0111\"]})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"button\",{style:{cursor:\"\".concat(cursor),backgroundColor:\"\".concat(backgroundColor),opacity:\"\".concat(opacity)},disabled:\"\".concat(disable),className:\"btn-muaVe\",onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var user,objectDatVe;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!localStorage.getItem(USER_LOGIN)){_context2.next=10;break;}user=JSON.parse(localStorage.getItem(USER_LOGIN));objectDatVe={'maLichChieu':props.match.params.maLichChieu,'danhSachVe':danhSachGheDangDat,'taiKhoanNguoiDung':user.taiKhoan};_context2.t0=dispatch;_context2.next=6;return datVeApiAction(objectDatVe);case 6:_context2.t1=_context2.sent;(0,_context2.t0)(_context2.t1).then(function(result){Swal.fire('Thông báo',result.message,result.status);if(result.code===200){dispatch({type:\"DAT_VE_THANH_CONG\"});}setTimeout(function(){props.history.push('/home');},4000);});_context2.next=11;break;case 10:props.history.push('/dangnhap');case 11:case\"end\":return _context2.stop();}}},_callee2);})),children:\"\\u0110\\u1EB7t V\\xE9\"})]})]})});}","map":{"version":3,"sources":["E:/FRONTEND/webphim/src/Page/Home/ChiTietPhongVe.js"],"names":["React","useEffect","useState","useDispatch","useSelector","datVeApiAction","layThongTinPhongVeApiAction","datGheAction","screen","Fragment","USER_LOGIN","swal","Swal","ChiTietPhongVe","props","thongTinPhongVe","state","QuanLyPhimReducer","danhSachGheDangDat","minutes","seconds","time","setTime","over","setOver","dispatch","fetchData","maLichChieu","match","params","window","innerHeight","height","setHeight","onresize","start","buttons","cancel","ok","then","value","reset","history","push","danhSachGhe","timerID","setInterval","clearInterval","renderCountDown","toString","padStart","tongTien","reduce","gheDangDat","index","giaVe","disable","cursor","backgroundColor","opacity","mangSapXepGheDangDat","sort","ghe","gheTT","stt","thongTinPhim","hinhAnh","tenCumRap","diaChi","map","classGheVip","loaiGhe","classGheDaDat","daDat","noiDungBtn","indexGheDangDat","findIndex","maGhe","classGheDangDat","length","text","toLocaleString","tenPhim","tenRap","ngayChieu","gioChieu","localStorage","getItem","user","JSON","parse","objectDatVe","taiKhoan","result","fire","message","status","code","type","setTimeout"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { datVeApiAction, layThongTinPhongVeApiAction } from '../../redux/actions/QuanLyPhimActions';\r\nimport { datGheAction } from '../../redux/actions/QuanLyPhimActions';\r\nimport screen from '../../assets/screen.png';\r\nimport { Fragment } from 'react';\r\nimport { USER_LOGIN } from '../../Util/Config';\r\nimport swal from 'sweetalert';\r\nimport Swal from 'sweetalert2';\r\n\r\nexport default function ChiTietPhongVe(props) {\r\n    const thongTinPhongVe = useSelector(state => state.QuanLyPhimReducer.thongTinPhongVe);\r\n    const danhSachGheDangDat = useSelector(state => state.QuanLyPhimReducer.danhSachGheDangDat);\r\n    const [time, setTime] = useState({ minutes: 0, seconds: 0 });\r\n    const [over, setOver] = useState(false);\r\n\r\n    const dispatch = useDispatch();\r\n    // useEffect(async () => {\r\n    //     let maLichChieu = props.match.params.maLichChieu;\r\n    //     dispatch(await layThongTinPhongVeApiAction(maLichChieu));\r\n    // }, []);\r\n    \r\n    useEffect(() => {\r\n        async function fetchData() {\r\n            let maLichChieu = props.match.params.maLichChieu;\r\n            dispatch(await layThongTinPhongVeApiAction(maLichChieu));\r\n        }\r\n        fetchData();\r\n      }, [props.match.params.maLichChieu,dispatch]); \r\n\r\n    const [height, setHeight] = useState(window.innerHeight);\r\n    useEffect(() => {\r\n        window.onresize = function () {\r\n            setHeight(window.innerHeight);\r\n        }\r\n    }, [height]);\r\n\r\n    const start = () => {\r\n        if (over) return;\r\n        if (time.minutes === 0 && time.seconds === 0) {\r\n            setOver(true);\r\n            swal(\"Hết thời gian giữ ghế vui lòng đặt lại!\", {\r\n                buttons: {\r\n                    cancel: \"Thoát!\",\r\n                    ok: \"Đặt lại vé\",\r\n                },\r\n            })\r\n                .then((value) => {\r\n                    switch (value) {\r\n                        case \"ok\":\r\n                            reset();\r\n                            break;\r\n\r\n                        default:\r\n                            props.history.push('/home');\r\n                    }\r\n                });\r\n        }\r\n        else if (time.seconds === 0)\r\n            setTime({\r\n                minutes: time.minutes - 1,\r\n                seconds: 59\r\n            });\r\n        else\r\n            setTime({\r\n                minutes: time.minutes,\r\n                seconds: time.seconds - 1\r\n            });\r\n    };\r\n    const reset = () => {\r\n        setTime({\r\n            minutes: 3,\r\n            seconds: 0\r\n        });\r\n        setOver(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if(thongTinPhongVe.danhSachGhe != null){\r\n            let timerID = setInterval(() => start(), 1000);\r\n             return () => clearInterval(timerID);\r\n            }\r\n    }, [start]);\r\n\r\n    useEffect(() => {\r\n       setTime({ minutes: 3, seconds: 0 })\r\n    }, []);\r\n\r\n    const renderCountDown = () => {\r\n        return (\r\n            <>\r\n                <p className=\"text\">Thời gian giữ ghế</p>\r\n                <p className=\"time\">{`${time.minutes.toString().padStart(2, '0')}:\r\n             ${time.seconds.toString().padStart(2, '0')}`}</p>\r\n            </>\r\n        )\r\n    }\r\n\r\n    let tongTien = danhSachGheDangDat.reduce((tongTien, gheDangDat, index) => {\r\n        return tongTien += gheDangDat.giaVe\r\n    }, 0)\r\n\r\n    let disable = (tongTien === 0) ? 'disable' : '';\r\n    let cursor = (tongTien === 0) ? 'no-drop' : '';\r\n    let backgroundColor = (tongTien === 0) ? '#cfcfcf' : '#fb4226';\r\n    let opacity = (tongTien === 0) ? '0.7' : '';\r\n    let mangSapXepGheDangDat = danhSachGheDangDat.sort((ghe, gheTT) => {\r\n        return ghe.stt - gheTT.stt;\r\n    })\r\n    return (\r\n        <section className=\"container-fluid chiTietPhongVe\">\r\n            <div className=\"chiTietPhongVe__content\">\r\n                <div className=\"chiTietPhongVe__manHinh\">\r\n                    {/* hien thi thong tin phong ve */}\r\n                    <div className=\"thongTin__Rap\">\r\n                        <div className=\"thongTin__Rap-content\">\r\n\r\n                            <div> <img src={thongTinPhongVe.thongTinPhim?.hinhAnh} alt=\"filmImage\" /></div>\r\n                            <div className=\"thongTin__Rap-diaChi\">\r\n                                <span className='ten__Rap'>{thongTinPhongVe.thongTinPhim?.tenCumRap}</span>\r\n                                <br />\r\n                                <span className='dia__Chi'>{thongTinPhongVe.thongTinPhim?.diaChi}</span>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"thongTin__Rap-timeOut\" >\r\n                            {renderCountDown()}\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"manHinh\">\r\n                        <img src={screen} alt=\"screen\" />\r\n                    </div>\r\n                    <div className=\"danhSachGhe\">\r\n                        {thongTinPhongVe.danhSachGhe?.map((ghe, index) => {\r\n                            let classGheVip = ghe.loaiGhe === 'Thuong' ? '' : 'gheVip';\r\n                            let classGheDaDat = ghe.daDat ? 'gheDaDat' : '';\r\n                            let disable = ghe.daDat ? 'disable' : '';\r\n                            let noiDungBtn = ghe.daDat ? 'X' : ghe.stt;\r\n                            let indexGheDangDat = danhSachGheDangDat.findIndex(gheDangDat => ghe.maGhe === gheDangDat.maGhe)\r\n\r\n                            let classGheDangDat = indexGheDangDat !== -1 ? 'gheDangDat' : '';\r\n                            return <Fragment key={index}>\r\n\r\n                                <button onClick={() => {\r\n                                    if (danhSachGheDangDat.length <= 5) {\r\n                                        dispatch(datGheAction(ghe.maGhe, ghe.stt, ghe.giaVe));\r\n                                    } else {\r\n                                        if (indexGheDangDat !== -1) {\r\n                                            dispatch(datGheAction(ghe.maGhe, ghe.stt, ghe.giaVe));\r\n                                        } else {\r\n                                            swal({ text: \"Mỗi booking chỉ tối đa 6 ghế!\" });\r\n                                        }\r\n                                    }\r\n                                }}\r\n                                    disabled={`${disable}`} className={`ghe ${classGheVip} ${classGheDaDat} ${classGheDangDat}`}>{noiDungBtn}</button>\r\n                                {(index + 1) % 16 === 0 ? <br /> : ''}\r\n                            </Fragment>\r\n                        })}\r\n\r\n                    </div>\r\n                    <div className='loaiGhe'>\r\n                        <div className='loaiGhe__item'>\r\n                            <span className='ghe'></span>\r\n                            <span>Ghế thường</span>\r\n                        </div>\r\n                        <div className='loaiGhe__item'>\r\n                            <span className='ghe gheVip'></span>\r\n                            <span>Ghế VIP</span>\r\n                        </div>\r\n                        <div className='loaiGhe__item'>\r\n                            <span className='ghe gheDaDat'>X</span>\r\n                            <span>Ghế đã được đặt</span>\r\n                        </div>\r\n                        <div className='loaiGhe__item'>\r\n                            <span className='ghe gheDangDat'></span>\r\n                            <span>Ghế đang chọn</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"chiTietPhongVe__thongTin\" style={{ height }}>\r\n                    <div className=\"thongTin__tongTien\">{danhSachGheDangDat.reduce((tongTien, gheDangDat, index) => {\r\n                        return tongTien += gheDangDat.giaVe\r\n                    }, 0).toLocaleString()} VND\r\n                    </div>\r\n                    <hr />\r\n                    <div className=\"m-0 d-flex\">\r\n                        <div className=\"thongTin_hinhAnh\">\r\n                            <img src={thongTinPhongVe.thongTinPhim?.hinhAnh} alt='phimImage' />\r\n                        </div>\r\n                        <div className=\"thongTin__phim\">\r\n                            <h4>{thongTinPhongVe.thongTinPhim?.tenPhim}</h4>\r\n                            <h6>{thongTinPhongVe.thongTinPhim?.tenCumRap} - {thongTinPhongVe.thongTinPhim?.tenRap}</h6>\r\n                            <p>{thongTinPhongVe.thongTinPhim?.ngayChieu} - {thongTinPhongVe.thongTinPhim?.gioChieu}</p>\r\n                        </div>\r\n                    </div>\r\n                    <hr />\r\n                    <div className=\"thongTin_ghe\">\r\n                        <div><span>Ghế: </span> {\r\n                            mangSapXepGheDangDat?.map((gheDangDat, index) => {\r\n                                return <span key={index} className='viTriGhe'>{gheDangDat.stt} &nbsp; </span>\r\n                            })}\r\n                        </div>\r\n                        <div className='tienGhe'>\r\n                            {danhSachGheDangDat.reduce((tongTien, gheDangDat, index) => {\r\n                                return tongTien += gheDangDat.giaVe\r\n                            }, 0).toLocaleString()} đ\r\n                        </div>\r\n                    </div>\r\n                    <hr />\r\n                    <button style={{ cursor: `${cursor}`, backgroundColor: `${backgroundColor}`, opacity: `${opacity}` }} disabled={`${disable}`} className='btn-muaVe' onClick={async () => {\r\n                        if (localStorage.getItem(USER_LOGIN)) {\r\n                            let user = JSON.parse(localStorage.getItem(USER_LOGIN))\r\n                            let objectDatVe = {\r\n                                'maLichChieu': props.match.params.maLichChieu,\r\n                                'danhSachVe': danhSachGheDangDat,\r\n                                'taiKhoanNguoiDung': user.taiKhoan\r\n                            }\r\n                            dispatch(await datVeApiAction(objectDatVe))\r\n                            .then((result) => {\r\n                                Swal.fire('Thông báo', result.message, result.status);\r\n                                if(result.code === 200){\r\n                                    dispatch({type: \"DAT_VE_THANH_CONG\"});\r\n                                }\r\n                                setTimeout(function(){ props.history.push('/home')},4000)\r\n                               \r\n                            });\r\n                            \r\n                        } else {\r\n                             props.history.push('/dangnhap')\r\n                        }\r\n                    }}>Đặt Vé</button>\r\n                </div>\r\n            </div>\r\n        </section >\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}